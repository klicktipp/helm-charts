{{ template "chart.header" . }}

{{ template "chart.deprecationWarning" . }}

{{ template "chart.badgesSection" . }}

{{ template "chart.description" . }}

{{ template "chart.homepageLine" . }}
{{ template "chart.maintainersSection" . }}
{{ template "chart.sourcesSection" . }}

{{ template "chart.valuesSection" . }}

## Examples

### 1. Cluster only

```yaml
rabbitmq:
  cluster:
    enabled: true
    name: app-rabbitmq
    replicas: 3
    persistence:
      enabled: true
      storage: 20Gi
      storageClassName: kt-gp3
```

### 2. Cluster + topology subchart

```yaml
rabbitmq:
  cluster:
    enabled: true
    name: app-rabbitmq

rabbitmq-topology:
  enabled: true
  rabbitmq:
    cluster:
      name: app-rabbitmq
    vhosts:
      app:
        enabled: true
        default: true
        name: app
    topology:
      queueDefaults:
        arguments:
          x-queue-type: quorum
        exchange:
          enabled: false
        binding:
          enabled: false
      exchanges:
        app-events:
          type: direct
          durable: true
          autoDelete: false
          vhost: app
      queues:
        email-request:
          name: email_request
          durable: true
          autoDelete: false
          vhost: app
      bindings:
        email-request:
          source: app-events
          destination: email_request
          destinationType: queue
          routingKey: email_request
          vhost: app
```

### 3. Topology to external cluster

```yaml
rabbitmq:
  cluster:
    enabled: false

rabbitmq-topology:
  enabled: true
  rabbitmq:
    cluster:
      name: existing-rabbitmq
    topology:
      exchanges:
        app-events:
          type: topic
```

### 4. Users from existing secrets (e.g. 1Password)

```yaml
rabbitmq-topology:
  enabled: true
  rabbitmq:
    topology:
      users:
        app-user:
          metadataName: app-user
          existingSecret: rabbitmq-user-app
          permission:
            referenceType: userReference
            metadataName: app-user
            enabled: true
            vhost: "/"
            configure: ".*"
            write: ".*"
            read: ".*"
```

### 5. Users with chart-managed secrets

```yaml
rabbitmq-topology:
  enabled: true
  rabbitmq:
    topology:
      users:
        smtp-user:
          metadataName: smtp-user
          password: "change-me"
          permission:
            referenceType: userReference
            metadataName: smtp-user
            enabled: true
            vhost: "/"
            configure: ".*"
            write: ".*"
            read: ".*"
```

### 6. Legacy Permission migration (`spec.user`)

```yaml
rabbitmq-topology:
  enabled: true
  rabbitmq:
    topology:
      users:
        app-user:
          name: app-user
          existingSecret: rabbitmq-user-app
          permission:
            metadataName: app-user
            referenceType: user
            user: app-user
            vhost: "/"
```

### 7. Preserve existing Kubernetes resource names (`metadata.name`)

```yaml
rabbitmq-topology:
  enabled: true
  rabbitmq:
    vhosts:
      app:
        name: app
        metadataName: app
    topology:
      exchanges:
        app-events:
          name: app-events
          metadataName: app-events
          type: direct
          vhost: app
      queues:
        email-request:
          name: email_request
          metadataName: email-request
          vhost: app
          exchange:
            enabled: false
          binding:
            enabled: false
      bindings:
        email-request:
          metadataName: email-request
          source: app-events
          destination: email_request
          destinationType: queue
          vhost: app
      policies:
        app-exchanges-ae:
          name: app-exchanges-ae
          metadataName: app-exchanges-ae
          pattern: "^app-events$"
          applyTo: exchanges
          vhost: app
          definition:
            alternate-exchange: app-events-fallback
```
